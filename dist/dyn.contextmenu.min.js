/*
 * jQuery UI ContextMenu
 *
 * Copyright 2011, Sebastian Sauer info@dynpages.de
 *
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.menu.js
 *	jquery.ui.position.js
 *
 *
 *	events:
 *		before
 *		open
 *		close
 *
 *
 *  public extra methods ( see ui.widget ):
 *    open
 *    close
 *    closeall
 *
 */(function(e){e.widget("dyn.contextmenu",{options:{pageX:0,pageY:0,menu:null,menuOptions:{},position:{my:"left+20 center+20",at:"left center",collision:"fit",using:function(t){e(this).css({top:t.top,left:t.left})}}},_isWindow:!1,_useDocumentFallback:!1,_create:function(){var t=this.options,n=this.element,r;if(!e.isFunction(e.ui.menu))throw"You need at least jQueryUi 1.9 || jquery.ui.menu.js";if(null===t.menu)return;n[0]&&e.isWindow(n[0])&&(this._isWindow=!0,e.browser.msie&&(this._useDocumentFallback=!0)),r=this.menulayer=t.menu.addClass(this.widgetName).hide(),r.data("menu")||r.menu(t.menuOptions),this._registerContextMenu(),this._zIndex=r.css("z-Index");if(!this._zIndex||/\D/.test(this._zIndex)){console&&console.log&&console.log("please provide a z-index for contextmenu. Destroying instance."),this.destroy();return}this._zIndex=parseInt(this._zIndex,10)-1,this._addFakeLayer(),this._on(this._fakeLayer,{click:"closeAll"})},_registerContextMenu:function(){var t;t=this._useDocumentFallback?e(document):this.element,this._on(t,{contextmenu:"open"})},_ui:function(){return{active:this.menulayer}},open:function(t){var n=this.options,r=this.menulayer,i;if(!1===this._trigger("before",t||null,this._ui())||n.disabled)return;this.closeAll(),this._fakeLayer.removeClass("ui-helper-hidden").css("z-Index",this._zIndex),t?(t.preventDefault(),i=e.extend(n.position,{of:t}),r.show().position(i)):r.css({left:""+n.pageX+"px",top:""+n.pageY+"px"}).show(),this._trigger("open",t||null,this._ui())},closeAll:function(){var t=e(window);e.isFunction(t.contextmenu)&&t.contextmenu("close"),e(":dyn-contextmenu").each(function(){e(this).contextmenu("close")})},close:function(e){this.menulayer.hide(),e&&(e.type="contextmenuclose"),this._fakeLayer.is(":visible")&&this._hideFakeLayer(),this._trigger("close",e||null,this._ui())},_addFakeLayer:function(){var t=this.options,n=this.widgetName+"-layer",r=e("."+n),i=e("body");if(i.length<1){this._fakeLayer=e();return}r.length<1&&(r=e("<div />").addClass(n),i.append(r)),this._fakeLayer=r},_hideFakeLayer:function(){this._fakeLayer.addClass("ui-helper-hidden").css("z-Index",""+ -1e6)},destroy:function(){var t="."+this.widgetName;this.menulayer.undelegate(t).unbind(t).removeClass(this.widgetName).menu("destroy"),this._isWindow&&e(window).unbind(t),this._superApply("destroy",arguments)}})})(jQuery);