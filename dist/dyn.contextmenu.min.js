/*
 * jQuery UI ContextMenu
 *
 * Copyright 2011, Sebastian Sauer info@dynpages.de
 *
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.menu.js
 *	jquery.ui.position.js
 *
 *
 *	events:
 *		before
 *		open
 *		close
 *
 *
 *  public extra methods ( see ui.widget ):
 *    open
 *    close
 *    closeall
 *
 */(function(a){a.widget("dyn.contextmenu",{options:{pageX:0,pageY:0,menu:null,menuOptions:{},position:{my:"left+20 center+20",at:"left center",collision:"fit",using:function(b){a(this).css({top:b.top,left:b.left})}}},_isWindow:!1,_useDocumentFallback:!1,_create:function(){var b=this.options,c=this.element,d;if(!a.isFunction(a.ui.menu))throw"You need at least jQueryUi 1.9 || jquery.ui.menu.js";if(null!==b.menu){c[0]&&a.isWindow(c[0])&&(this._isWindow=!0,a.browser.msie&&(this._useDocumentFallback=!0)),d=this.menulayer=b.menu.addClass(this.widgetName).hide(),d.data("menu")||d.menu(b.menuOptions),this._registerContextMenu(),this._zIndex=d.css("z-Index");if(!this._zIndex||/\D/.test(this._zIndex)){console&&console.log&&console.log("please provide a z-index for contextmenu. Destroying instance."),this.destroy();return}this._zIndex=parseInt(this._zIndex,10)-1,this._addFakeLayer(),this._bind(this._fakeLayer,{click:"closeAll"})}},_registerContextMenu:function(){var b;b=this._useDocumentFallback?a(document):this.element,this._bind(b,{contextmenu:"open"})},_ui:function(){return{active:this.menulayer}},open:function(b){var c=this.options,d=this.menulayer,e;!1!==this._trigger("before",b||null,this._ui())&&!c.disabled&&(this.closeAll(),this._fakeLayer.removeClass("ui-helper-hidden").css("z-Index",this._zIndex),b?(b.preventDefault&&(b.preventDefault(),b.stopImmediatePropagation()),e=a.extend(c.position,{of:b}),d.show().position(e)):d.css({left:""+c.pageX+"px",top:""+c.pageY+"px"}).show(),this._trigger("open",b||null,this._ui()))},closeAll:function(){this._isWindow&&this.close(),a(":dyn-contextmenu").contextmenu("close")},close:function(a){this.menulayer.hide(),a&&(a.type="contextmenuclose"),this._fakeLayer.is(":visible")&&this._hideFakeLayer(),this._trigger("close",a||null,this._ui())},_addFakeLayer:function(){var b=this.options,c=this.widgetName+"-layer",d=a("."+c),e=a("body");e.length<1||(d.length<1&&(d=a("<div />").addClass(c),e.append(d)),this._fakeLayer=d)},_hideFakeLayer:function(){this._fakeLayer.addClass("ui-helper-hidden").css("z-Index",""+ -1e6)},destroy:function(){var b="."+this.widgetName;this.menulayer.undelegate(b).unbind(b).removeClass(this.widgetName).menu("destroy"),a(":dyn-contextmenu").length<1&&a(window).unbind(b),this._superApply("destroy",arguments)}})})(jQuery)